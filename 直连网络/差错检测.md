### 组帧

组帧是数据链路层的**网络适配器(网卡)**需要完成的工作

适配器包含一个信令组件, 在发送方可以将比特编码为信号, 在接收方可以把信号解码为比特

网络结点间交换的是数据块(在数据链路层称为帧), 而不是比特流

- 关心的是帧，而不是比特序列，网络适配器使得结点之间能够交换帧


### 问题: 适配器如何组帧?(如何识别帧的位置和起止位置)

#### 两种方式

#### 面向字节的组帧:

- 早期使用的组帧方法, 把每一帧看成是一个字符(字节, ASCII码为8位的字节)的集合

    - 起止标记法
        
        - 使用一系列特定的字符表示帧的开始与结束
            - SYN(同步字符): 标志一帧开始发送
            - SOH(头部开始符)
            - STX(正文开始符)
            - ETX(正文结束符)
            - CRC(循环冗余校验位)
        - 问题: 如果正文部分也有特殊字符(e.g. 正文出现了结束字符ETX), 可能会引起数据解释错误(**数据帧的透明传输**)
            - 解决办法: 引入转义字符DLE(Data Link Escape, 数据通信换码符), 由发送方负责将数据部分所有的ETX用DLE填充进行转义, 同时DLE本身也需要进行转义
            - 如果遇到一个连续的DLE+ETX序列, 则接收方知道这个ETX不是结束字段的ETX。
    - 字节计数法
        - 在首部用一个特殊字段count记录本帧的长度(同时也应用SYN字符标志一帧的开始)

        - 问题: 如果count字段传输中出现差错, 可能会影响后续数据的读取(比如把本不属于本帧的部分计入本帧)

#### 面向比特的组帧

- 后期针对面向字节组帧方法的缺点改进的方法, 不再关心以字节为单位的比特段, 而是具体到以比特为单位的二进制位

    - 用一个特殊选定的标志字段来标志一帧的开始和结束
        - e.g. 01111110
        - 在链路空闲时, 也发送01111110序列以保证发方和收方的时钟同步
    - 问题(同样是透明传输问题): 如果数据部分也出现了01111110这个比特序列, 则会引起帧的边界判断错误
        - 解决方案: 比特填充法: 发送方在发送数据帧之前, 先用硬件或软件扫描一遍整个数据部分, 只要发现了5个连续的1, 就立即填入一个0
        - 接收方在读取数据时, 首先找出一个01111110序列确定帧开头, 之后向后读取数据部分:
            
            - 如果出现了连续5个1, 判断下一位比特的值:

                1. 如果下一位是0, 则一定是填充的0, 丢弃这一个0, 继续读取数据
                2. 如果下一位是1, 则继续判断下一个位, 如果下一个位是0, 则代表帧已经结束, 否则帧出错了(数据段出现了连续7个1)