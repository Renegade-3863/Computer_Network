## 媒体共享技术
### 静态划分信道
    - 信道复用技术(multiplexing), 为多个用户静态划分逻辑信道, 相互不冲突
    - 频分复用, 时分复用, 波分复用, 码分复用

#### 频分复用(Frequency Division Multiplexing, FDM)
    - 用户分配到一定的频带(频段)后, 在通信过程中, 自始至终都占用该频带(频段)
        - 所有的用户在同样的时间占用各自的资源
#### 时分复用(Time Division Multiplexing, TDM)
    - 将时间划分为一段段等长的时分复用帧(TDM帧)
        - 每个用户在每个TDM帧中占用固定序号的时隙, 占用的时隙周期性的出现(周期为TDM帧的长度)
        - 所有用户在不同的时间占用同样的频带宽度
    - TDM类似电路交换, 由于计算机网络的数据传输具有突发性, 故TDM的总宽带利用率不高

#### 统计时分复用(static TDM, STDM)
    - 按需动态分配时隙
        - 每个STDM帧的时隙数小于用户数(个人理解是为了提高信息传输的效率, 因为复用器是在一个帧结束后才会发送该帧)
        - 每个用户所占时隙非周期性出现, 又称异步时分复用; TDM称同步时分复用
        - 每个时隙中必须有用户的地址信息
#### 波分复用(Wavelength Division Multiplexing, WDM)
    - 光的频分复用
        - 光载波的频率很高, 习惯用波长而非频率表示
#### 码分复用(Code Division Multiplexing, CDM)
    - 码分多址(Code Division Multiple Access, CDMA)
        - 基于扩频技术
            - 发送端: 将需传送的具有一定信号带宽的信息数据, 用一个带宽远大于信号带宽的高速伪随机码进行调制, 使原数据信号的带宽被扩展, 再经载波调制并发送出去
            - 接收端使用完全相同的伪随机码, 与接收的带宽信号作相关处理, 把宽带信号换成原信息数据的窄带信号即解扩, 以实现信息通信
    - 每1比特时间划分为m个端的间隔, 称为码片(chip)
        - 每个用户被指派一个唯一的m bit码片序列
            - m一般为64或128
            - 发送比特1, 则发送自己的m bit码片序列
            - 发送比特0, 则发送该码片序列的二进制反码
            - 扩频: 假定S站要发送信息的数据率为b bit/s。由于每一个比特要转换成m个比特的码片, 因此S站实际上发送的数据率提高到mb bit/s, 同时S站所占用的频带宽度也提高到原来的m倍
### 动态媒体接入控制, 多点接入(multiple access)
- 信道不固定分配给用户, 实际接入时动态接入, 分布式算法
    - 随机接入: 结点按需随机接入, 需解决碰撞问题(多个结点同时尝试接入信道)
    - 受控接入: 结点接入服从一定控制, 如令牌环网
#### 随机接入
- 结点按需随机接入, 接入后以信道的全部速率进行发送
- 发生碰撞时, 相关结点反复重发, 直到无碰撞成功发送
    - 冲突域(collision domain), 冲突/碰撞(collide)
- 各结点在重发前独立选择一个随机时延
- 典型方案
    - (一) ALOHA
        - 为无线网络研制的, 但能用于任何传输介质
        - 基本思想
            - 帧首次到达(从网络层传递下来)时, 立即发送该帧
            - 若碰撞, 结点立即(发送完当前碰撞帧后)以概率p重传该帧(p-坚持), 1-p概率等待一个帧传输时间
            - 若不成功, 在下一个阶段, 同样以概率p重传该帧, 或以1-p的概率等待
    - (二) 时隙ALOHA
        - 改进的ALOHA
            - 为避免一个帧快传完时被别的结点发送的帧碰撞
        - 基本思想
            - 设所有帧长为L bits, 把时间划分为L/R(R为传输速率)秒的时隙
                - 一个时隙为传输一帧的时间
            - 结点只在时隙开始时传输帧, 所有结点时间同步
            - 若一个时隙中有帧发生碰撞, 所有结点都能在该时隙结束前检测到
            - 如何发送:
                - 结点有帧要发送时, 等到下一时隙开始
                - 若没有碰撞, 则成功发送
                - 若碰撞, 在该时隙结束前检测到, 以概率p在后续的每个时隙发送该帧, 直到成功传输
    - (三) 载波侦听多点接入(Carrier Sense Multiple Access, CSMA)
        - 多点接入
            - 广播链路, 多个结点以多点接入的方式连接在同一链路, 同一冲突域
        - 载波侦听
            - 结点在发送前先检测信道, 是否有其它结点也在发送, 若有, 则暂时不要发送数据, 以免发生碰撞
                - 总线上并没有"载波", 只是一种形象的比喻, 结点可识别链路的忙闲状态
            - 根据具体的侦听/发送策略, CSMA可分为3类
                - 非持续CSMA: 可减少碰撞, 会导致信道利用率降低, 较长的延迟
                - 1-坚持CSMA: 会导致较多的碰撞, 导致性能降低
                - p-坚持CSMA: 通过调节p在减少碰撞和高信道利用率间取得平衡
    - (四) 带碰撞检测(Collision Detection)的CSMA(CSMA/CD)
        - 核心思想
            - 1-坚持CSMA+碰撞检测
        - 碰撞检测
            - 结点边发送数据边检测信道上的信号电压大小
                - 几个结点同时发送数据时, 总线上的信号电压摆动值将会增大(互相叠加)
                - 当结点检测到的信号电压摆动值超过一定的门限值时, 认为总线上至少有两个结点同时在发送数据, 表明发生了碰撞
                - 发生碰撞时, 总线上传输的信号产生严重失真, 无法从中恢复出有用信息
                - 因此, 每个正在发送数据的结点一旦发现出现了碰撞, 需立即停止发送, 免得继续浪费网络资源, 然后等待一段随机时间后再次发送
        - 侦听/发送
            - 发送数据时, 侦听链路中是否有其它数据在传输
                - 如果信道忙(有比特流经过本机接口, 且不是传输给本机的数据流), 则继续侦听等待
                - 如果检测信道空闲, 等待一个最小帧间间隔时间, 传输数据帧
                    - 以太网最小帧间间隔为9.6微秒, 为了使刚刚接收帧的结点能清理接收缓存
                - 在**传输过程中**, 如果遇到碰撞, 执行**碰撞处理**操作
        - 碰撞处理
            - 立即停止发送数据帧, 并发送特殊阻塞信息, 人为的干扰信号(jamming signal), 通告其它设备有碰撞发生
            - 退避一段时间后重传数据帧: 根据发生碰撞的次数, 计算指数退避时间(exponential backoff), 在时间范围内随机选择一个, 进行等待后重发数据帧
            - 在尝试给定次数之后将放弃尝试, 并向上层报告传输出错
        - 应用于总线型以太网(半双工通信链路)中
            - 结点不能同时收发数据, 但边发送边侦听
        - **碰撞窗口/争用期**
            - 每个结点发送数据后的一小段时间内, 存在着遭遇碰撞的可能性
                - 时间取决于另一数据发送结点与该结点的距离
            - 以太网的端到端往返时延2t称为碰撞窗口/争用期
                - 结点发送数据帧后, 至多经过时间2t, 可知是否发生了碰撞
                - 经过争用期这段时间还没有检测到碰撞, 才能肯定这次发送不会发生碰撞
            - CSMA/CD需遵循一个重要原则-帧必须足够长
                - 必须让发方在发送结束之前检测到冲突
                - 如: 以太网中, 争用期为52.2微秒(人为规定), 10Mbps传输速率(发送速率)的以太网对应一个512bits的帧 (即64字节的一个最小帧长)
        - 强化碰撞
            - 当发送数据的结点一旦发现发生了碰撞时, 立即停止发送数据, 并继续发送若干(e.g. 48bits)的人为干扰信号(jamming signal), 以便让所有结点知道现在已经发生了碰撞
        - 指数退避(exponential backoff)算法
            - 发生碰撞的结点在停止发送数据后, 要推迟(退避)一个随机时间才能再发送数据
            - 随机时间怎么确定:
                - 基本退避时间取为争用期2t
                - 从整数集合[0,1,...,(2^k-1)]中随机的取出一个数, 记为r, 重传所需退避的时间为r倍的基本退避时间
                    - k的取值为: k = min[重传次数, 10]
                - 当重传次数达16次仍然不能成功传输, 丢弃该帧, 并向高层报告数据帧
    - (五) 带碰撞避免(Collision Avoidance)的CSMA(CSMA/CA)
        - 核心思想
            - 非持续CSMA+碰撞避免
        - 应用于802.11无线局域网(Wireless LAN, WLAN)
        - 为什么冲突避免, 而非冲突检测?
            - 碰撞检测的能力要求结点同时具有发送(自己的信号)和接收(检测其它结点是否在发送)的能力
                - 无线网络适配器上, 接收信号的强度远小于发送信号, 制造具有碰撞检测能力的硬件代价过大
            - 即使硬件支持, 无线网络特有的**隐藏终端**等问题也使得很多碰撞难以检测
            - 隐藏终端问题(hidden station problem):
                - 结点A和结点C互相检测不到对方的信号, 可能同时向B发送数据, 引发碰撞
        - 侦听/发送
            - 发送数据时, 先侦听信道是否空闲
                - 若信道忙, 等待, 再次侦听(**非持续CSMA的特点**)
                - 若信道空闲
                    - 第一次尝试发送, 在一段时间(分布式帧间间隔, DIFS)后, 立即发送
                    - 非第一次尝试发送, 执行碰撞避免操作, 发送数据
                - 成功发送后等待对端回复ACK, 等待超时, 重传该帧
            - **碰撞避免**
                
                1. 信道空闲一段时间(分布式帧间间隔, DIFS)后, 进入竞争窗口, 延迟接入
                    - 结点按照各自当前的状态(重传次数), 按照二进制指数退避算法选择随机退避时间, 退避完成发送数据; 若退避未完成时检测到信道忙, 则冻结退避计时器, 等到信道空闲持续DIFS时间后继续退避, 直至退避完成后, 继续发送数据
                2. 发送, 接收结点通过RTS/CTS短帧预约信道, 避免碰撞(这一机制主要用于避免隐藏终端问题)